<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lumen Office RPG</title>

<style>
body{
  background:#0e0f14;
  color:#e6e6e6;
  font-family:"Courier New", monospace;
  margin:0;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#game{
  width:900px;
  max-width:95%;
  background:#1a1d27;
  padding:20px;
  border-radius:14px;
  box-shadow:0 0 40px rgba(0,0,0,.8);
  position:relative;
}

h1{text-align:center;color:#ff6f61;margin-top:0;}

.panel{
  background:#252a3a;
  padding:12px;
  border-radius:8px;
  margin-bottom:10px;
}

#stats{
  display:flex;
  justify-content:space-between;
  font-size:.9em;
}

#inventory span{
  background:#ff6f61;
  padding:3px 6px;
  margin-right:6px;
  border-radius:4px;
  font-size:.8em;
}

button{
  width:100%;
  margin:6px 0;
  padding:10px;
  background:#ff6f61;
  border:none;
  border-radius:6px;
  color:#fff;
  cursor:pointer;
  font-weight:bold;
}
button:hover{background:#ff4b3a;}

input{
  width:100%;
  padding:8px;
  margin-top:6px;
  border-radius:5px;
  border:none;
}

.flicker{animation:flicker .15s linear;}
@keyframes flicker{
  0%{opacity:1}50%{opacity:.7}100%{opacity:1}
}
</style>
</head>

<body>
<div id="game">
<h1>Lumen Office RPG</h1>

<div class="panel">
<strong>Survival Notes</strong><br>
• Low <b>Sanity</b> distorts text and perception<br>
• <b>Memory</b> unlocks deeper paths<br>
• <b>Suspicion</b> limits options<br>
• Puzzles always include hints
</div>

<div id="stats" class="panel"></div>
<div id="inventory" class="panel">Inventory:</div>
<div id="story" class="panel"></div>
<div id="choices"></div>
<div id="puzzle" class="panel"></div>
</div>

<script>
/* ---------- GAME STATE ---------- */
const game={
  state:"intro",
  sanity:100,
  memory:40,
  suspicion:0,
  inventory:[],
  flags:{keycard:false,door:false,file:false},
  flickerCooldown:false
};

const secrets=["Keycard","USB Drive","Encrypted Notes"]
  .sort(()=>Math.random()-0.5);

/* ---------- UI HELPERS ---------- */
function render(){
  document.getElementById("stats").innerText=
    `Sanity:${game.sanity} | Memory:${game.memory} | Suspicion:${game.suspicion}`;
  document.getElementById("inventory").innerHTML=
    "Inventory: "+game.inventory.map(i=>`<span>${i}</span>`).join("");
}

function setStory(t){
  const s=document.getElementById("story");
  s.innerText=game.sanity<50 && Math.random()<0.3
    ? t.split("").sort(()=>Math.random()-0.5).join("")
    : t;
  s.style.filter=game.sanity<50?"blur(1.5px)":"none";
}

function setChoices(arr){
  const c=document.getElementById("choices");
  c.innerHTML="";
  arr.forEach(o=>{
    const b=document.createElement("button");
    b.innerText=o.t;
    b.onclick=o.a;
    c.appendChild(b);
  });
}

function puzzle(html){ document.getElementById("puzzle").innerHTML=html; }
function clearPuzzle(){ document.getElementById("puzzle").innerHTML=""; }

/* ---------- FLICKER ---------- */
setInterval(()=>{
  if(!game.flickerCooldown && Math.random()<0.03){
    game.flickerCooldown=true;
    gameDiv.classList.add("flicker");
    setTimeout(()=>gameDiv.classList.remove("flicker"),150);
    setTimeout(()=>game.flickerCooldown=false,5000);
  }
},3000);

const gameDiv=document.getElementById("game");

/* ---------- STORY STATES ---------- */
function intro(){
  game.state="intro";
  setStory("You awaken at your desk. The monitor reads: WELCOME BACK.");
  setChoices([
    {t:"Inspect desk",a:desk},
    {t:"Enter hallway",a:hallway}
  ]);
  clearPuzzle(); render();
}

function desk(){
  game.memory+=5;
  game.flags.keycard=true;
  game.inventory.push(secrets[0]);
  setStory("Inside the drawer: a LEVEL 2 badge and a strange sense of déjà vu.");
  setChoices([{t:"Leave desk",a:hallway}]);
  render();
}

function hallway(){
  setStory("A quiet hallway. A locked security door. An elevator hums.");
  setChoices([
    {t:"Security door",a:()=>game.flags.keycard?security():denied()},
    {t:"Elevator",a:()=>ending("escape")},
    {t:"Explore side corridor",a:surveillance}
  ]);
}

function denied(){
  game.sanity-=5; game.suspicion+=5;
  setStory("Access denied. A red light blinks.");
  setChoices([{t:"Step back",a:hallway}]);
  render();
}

function surveillance(){
  setStory("You enter a room of monitors. One shows your desk.");
  setChoices([
    {t:"Search drawers",a:()=>{game.inventory.push(secrets[1]); game.memory+=5; hallway();}},
    {t:"Leave quickly",a:hallway}
  ]);
  render();
}

function security(){
  setStory("A keypad waits.");
  puzzle(`
    <b>PUZZLE: DOOR ACCESS</b><br>
    Hint: Badge level equals the code.<br>
    <input id="code">
    <button onclick="checkDoor()">Unlock</button>
  `);
}

function checkDoor(){
  if(document.getElementById("code").value==="2"){
    game.flags.door=true; game.memory+=10;
    clearPuzzle(); terminal();
  } else { game.sanity-=10; }
  render();
}

function terminal(){
  setStory("A terminal displays an encoded file.");
  setChoices([
    {t:"Decode file",a:filePuzzle},
    {t:"Leave",a:hallway}
  ]);
}

function filePuzzle(){
  puzzle(`
    <b>PUZZLE: FILE DECODE</b><br>
    Hint: Shift each letter in LUMEN forward by one.<br>
    <input id="decode">
    <button onclick="checkFile()">Submit</button>
  `);
}

function checkFile(){
  if(document.getElementById("decode").value.toLowerCase()==="mvnfo"){
    game.flags.file=true; game.memory+=20;
    ending("truth");
  } else { game.sanity-=10; }
  render();
}

function ending(type){
  clearPuzzle();
  setChoices([{t:"Restart Game",a:()=>location.reload()}]);
  setStory(
    type==="truth"
      ?"You uncover the truth. The office was never meant to end."
      :"The elevator descends. You leave with your memory erased."
  );
}

/* ---------- START ---------- */
intro();
</script>
</body>
</html>
