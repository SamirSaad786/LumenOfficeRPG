<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Lumen Office RPG</title>

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: #0e0f13;
  color: #e6e6e6;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#game {
  width: 760px;
  max-width: 95%;
  background: #14161c;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 0 40px rgba(0,0,0,0.7);
  position: relative;
}

h1 {
  margin-top: 0;
  text-align: center;
}

#instructions {
  font-size: 0.85em;
  background: #1b1e26;
  padding: 10px;
  border-radius: 8px;
  margin-bottom: 12px;
  line-height: 1.4;
}

#stats {
  display: flex;
  justify-content: space-between;
  font-size: 0.9em;
  margin-bottom: 10px;
}

#story {
  min-height: 140px;
  margin-bottom: 16px;
  line-height: 1.5;
}

#choices button {
  display: block;
  width: 100%;
  margin: 6px 0;
  padding: 10px;
  background: #242838;
  border: none;
  color: #fff;
  border-radius: 6px;
  cursor: pointer;
}

#choices button:hover {
  background: #30365a;
}

#puzzle {
  background: #1c1f2c;
  padding: 12px;
  border-radius: 8px;
  margin-top: 10px;
}

input {
  width: 100%;
  padding: 8px;
  margin-top: 6px;
}

#restart {
  margin-top: 16px;
  background: #8a2e2e;
}

.flicker {
  animation: flicker 0.15s linear;
}

@keyframes flicker {
  0% { opacity: 1; }
  50% { opacity: 0.7; }
  100% { opacity: 1; }
}
</style>
</head>

<body>
<div id="game">
  <h1>Lumen Office RPG</h1>

  <div id="instructions">
    <strong>How to Survive:</strong><br>
    • Low <strong>Sanity</strong> scrambles text.<br>
    • <strong>Memory</strong> unlocks deeper truths.<br>
    • <strong>Suspicion</strong> attracts attention.<br>
    • Puzzles always include hints — read carefully.
  </div>

  <div id="stats"></div>
  <div id="story"></div>
  <div id="choices"></div>
  <div id="puzzle"></div>
</div>

<script>
const game = {
  state: "intro",
  sanity: 100,
  memory: 0,
  suspicion: 0,
  flags: {
    hasKeycard: false,
    doorUnlocked: false,
    fileDecoded: false
  }
};

function renderStats() {
  document.getElementById("stats").innerText =
    `Sanity: ${game.sanity} | Memory: ${game.memory} | Suspicion: ${game.suspicion}`;
}

function setStory(text) {
  document.getElementById("story").innerText = text;
}

function setChoices(options) {
  const container = document.getElementById("choices");
  container.innerHTML = "";
  options.forEach(opt => {
    const btn = document.createElement("button");
    btn.innerText = opt.text;
    btn.onclick = opt.action;
    container.appendChild(btn);
  });
}

function clearPuzzle() {
  document.getElementById("puzzle").innerHTML = "";
}

function flickerRandomly() {
  if (Math.random() < 0.08) {
    document.getElementById("game").classList.add("flicker");
    setTimeout(() => {
      document.getElementById("game").classList.remove("flicker");
    }, 150);
  }
}
setInterval(flickerRandomly, 3000);

function intro() {
  game.state = "intro";
  setStory("You sit at your desk. The screen reads: 'WELCOME BACK.' You do not remember leaving.");
  setChoices([
    { text: "Inspect your desk", action: desk },
    { text: "Stand up and look around", action: hallway }
  ]);
  clearPuzzle();
}

function desk() {
  game.state = "desk";
  game.memory += 5;
  setStory("Inside the drawer you find a badge labeled 'ACCESS — LEVEL 2'.");
  game.flags.hasKeycard = true;
  setChoices([
    { text: "Leave the desk", action: hallway }
  ]);
  clearPuzzle();
}

function hallway() {
  game.state = "hallway";
  setStory("A silent hallway stretches ahead. A locked security door blocks one path.");
  setChoices([
    {
      text: "Try the security door",
      action: () => game.flags.hasKeycard ? securityDoor() : lockedOut()
    },
    { text: "Approach the elevator", action: elevator }
  ]);
  clearPuzzle();
}

function lockedOut() {
  game.sanity -= 5;
  setStory("The door refuses to open. A red light blinks. You feel watched.");
  setChoices([{ text: "Step back", action: hallway }]);
}

function securityDoor() {
  game.state = "security";
  setStory("A keypad awaits input.");
  showKeypadPuzzle();
}

function showKeypadPuzzle() {
  document.getElementById("puzzle").innerHTML = `
    <strong>Door Puzzle</strong><br>
    Hint: The badge reads 'LEVEL 2'. Think simple.<br>
    <input id="code" placeholder="Enter code">
    <button onclick="checkCode()">Unlock</button>
  `;
}

function checkCode() {
  const val = document.getElementById("code").value;
  if (val === "2") {
    game.flags.doorUnlocked = true;
    game.memory += 10;
    clearPuzzle();
    securityRoom();
  } else {
    game.sanity -= 10;
    showKeypadPuzzle();
  }
}

function securityRoom() {
  setStory("Inside the security room, a terminal glows with encrypted files.");
  setChoices([
    { text: "Decode the file", action: filePuzzle },
    { text: "Leave quietly", action: hallway }
  ]);
}

function filePuzzle() {
  document.getElementById("puzzle").innerHTML = `
    <strong>File Decode</strong><br>
    Hint: The word 'LUMEN' shifted forward by 1 letter.<br>
    <input id="decode" placeholder="Decoded word">
    <button onclick="checkFile()">Submit</button>
  `;
}

function checkFile() {
  const val = document.getElementById("decode").value.toLowerCase();
  if (val === "mvnfo") {
    game.flags.fileDecoded = true;
    game.memory += 15;
    ending("truth");
  } else {
    game.sanity -= 10;
  }
}

function elevator() {
  ending("escape");
}

function ending(type) {
  clearPuzzle();
  setChoices([
    { text: "Restart Game", action: () => location.reload() }
  ]);

  if (type === "truth") {
    setStory("You uncover the truth. The office was never meant to let you leave.");
  } else {
    setStory("The elevator descends. You escape — but remember nothing.");
  }
}

renderStats();
intro();
</script>
</body>
</html>
