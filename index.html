<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lumen Office RPG</title>
<style>
  body {
    font-family: 'Courier New', monospace;
    background-color: #1e1e1e;
    color: #e0e0e0;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }
  .game-container {
    max-width: 900px;
    margin: 2rem auto;
    padding: 2rem;
    background-color: #2b2b2b;
    border-radius: 10px;
    box-shadow: 0 0 30px #000;
    position: relative;
  }
  h1 {
    text-align: center;
    color: #ff6f61;
  }
  .instructions {
    background-color: #444;
    padding: 1rem;
    border-radius: 5px;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    line-height: 1.4;
    color: #ffd700;
  }
  .text-box {
    margin-top: 1rem;
    padding: 1rem;
    background-color: #3c3c3c;
    border-radius: 5px;
    min-height: 120px;
    white-space: pre-line;
    transition: filter 0.2s;
  }
  .options {
    margin-top: 1rem;
    display: flex;
    flex-direction: column;
  }
  button {
    margin: 0.5rem 0;
    padding: 0.7rem;
    border: none;
    border-radius: 5px;
    background-color: #ff6f61;
    color: #fff;
    cursor: pointer;
    font-weight: bold;
    transition: transform 0.1s;
  }
  button:hover {
    background-color: #ff4b3a;
    transform: scale(1.05);
  }
  .stats {
    margin-top: 1rem;
    display: flex;
    justify-content: space-around;
  }
  .inventory {
    margin-top: 1rem;
    background-color: #3c3c3c;
    padding: 0.5rem;
    border-radius: 5px;
  }
  .inventory span {
    display: inline-block;
    margin-right: 10px;
    background-color: #ff6f61;
    padding: 3px 7px;
    border-radius: 3px;
  }
  .puzzle-input {
    margin-top: 0.5rem;
    padding: 0.5rem;
    border-radius: 5px;
    border: none;
    width: 80%;
  }
  .puzzle-btn {
    margin-top: 0.5rem;
    padding: 0.5rem;
    border: none;
    border-radius: 5px;
    background-color: #6fcf97;
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }
  .restart-btn {
    margin-top: 1rem;
    padding: 0.7rem;
    border-radius: 5px;
    border: none;
    background-color: #ffce67;
    color: #000;
    font-weight: bold;
    cursor: pointer;
  }
  .restart-btn:hover {
    background-color: #ffb347;
  }
  .flicker {
    opacity: 0.3 !important;
    transition: opacity 0.1s;
  }
</style>
</head>
<body>

<div class="game-container" id="game-container">
  <h1>Lumen Office RPG</h1>
  
  <div class="instructions">
    <strong>Tips:</strong><br>
    - Keep <strong>Sanity</strong> above 50 to prevent text from blurring or scrambling.<br>
    - Use clues and puzzles to increase <strong>Memory</strong> and unlock secrets.<br>
    - High <strong>Suspicion</strong> may limit your optionsâ€”choose wisely.<br>
    - Collect items like keycards, USB drives, and encrypted notes to access hidden areas.<br>
    - Solve puzzles carefully to avoid sanity loss.<br>
    - Click options below to progress. You can restart anytime at the end.
  </div>

  <div class="stats">
    <div>Memory: <span id="memory">50</span></div>
    <div>Suspicion: <span id="suspicion">0</span></div>
    <div>Sanity: <span id="sanity">100</span></div>
  </div>
  <div class="inventory">Inventory: <span id="inventory"></span></div>
  <div class="text-box" id="story">
    You wake up in the office. Your memory feels fragmented. Outside, the world seems distant. What do you do first?
  </div>
  <div class="options" id="options"></div>
</div>

<script>
/* --- Game Variables --- */
let currentStep = 0;
let memory = 50;
let suspicion = 0;
let sanity = 100;
let inventory = [];
let secrets = ["Keycard", "USB Drive", "Encrypted Notes"].sort(() => Math.random() - 0.5);

/* --- Utility Functions --- */
function updateStats() {
  document.getElementById('memory').innerText = memory;
  document.getElementById('suspicion').innerText = suspicion;
  document.getElementById('sanity').innerText = sanity;
  document.getElementById('inventory').innerHTML = inventory.map(item => `<span>${item}</span>`).join('');
}

function scrambleText(text) {
  if (sanity < 50 && Math.random() < 0.3) return text.split('').sort(() => Math.random() - 0.5).join('');
  return text;
}

function sanityEffect() {
  const storyBox = document.getElementById('story');
  if (sanity < 50) {
    storyBox.style.filter = "blur(2px)";
    setTimeout(() => storyBox.style.filter = "blur(0)", 500);
  } else storyBox.style.filter = "none";
}

/* --- Random flicker --- */
function randomFlicker() {
  const container = document.getElementById('game-container');
  if(Math.random() < 0.05) { // 5% chance per second
    container.classList.add('flicker');
    setTimeout(() => container.classList.remove('flicker'), 100);
  }
}
setInterval(randomFlicker, 1000);

/* --- Story & Choices --- */
const storyText = [
  "You wake up in the office. Your memory feels fragmented. Outside, the world seems distant.",
  "You check your desk and find a mysterious file labeled 'Project LUMEN'.",
  "You walk to the elevator. The buttons flicker and one seems stuck.",
  "You explore the office hallway. A door at the end seems to lead to a hidden room.",
  "You open the file fully. Instructions: 'Unlock the secrets, but do not get caught.'",
  "The elevator jolts. Do you risk pressing the stuck button?",
  "The hidden room contains surveillance monitors. You feel watched.",
  `You find a ${secrets[0]} here. It might help later.`,
  `You find a ${secrets[1]} hidden behind a monitor.`,
  `You find ${secrets[2]} tucked away in a drawer.`,
  "Door locked! Enter the 3-digit code to unlock the restricted floor.",
  "File decoding challenge! Enter the word hidden in the cipher: 'LZOP'.",
  "You escape and see the world outside. Ending A: Freedom.",
  "You are caught while exploring. Ending B: Captured.",
  "You successfully uncover all secrets. Ending C: Mastermind.",
  "You ignore everything and continue routine work. Ending D: Forgotten."
];

const options = [
  [ {text:"Check desk", next:1}, {text:"Walk to elevator", next:2}, {text:"Explore hallway", next:3} ],
  [ {text:"Open file fully", next:4, memory:+10, sanity:-5}, {text:"Leave it", next:3, suspicion:+5} ],
  [ {text:"Press stuck button", next:5, suspicion:+10, sanity:-5}, {text:"Take stairs", next:3} ],
  [ {text:"Enter hidden room", next:6}, {text:"Return to desk", next:1} ],
  [ {text:"Investigate monitors", next:7, memory:+5}, {text:"Leave room quietly", next:3, suspicion:-5} ],
  [ {text:"Risk elevator again", next:2}, {text:"Take stairs", next:3} ],
  [ {text:"Take secret 1", next:8, inventory:secrets[0]}, {text:"Take secret 2", next:9, inventory:secrets[1]}, {text:"Take secret 3", next:10, inventory:secrets[2]}, {text:"Leave room", next:3} ],
  [ {text:"Use keycard on restricted floor", next:11, memory:+20}, {text:"Ignore and leave", next:3} ],
  [ {text:"Explore more floors", next:11, memory:+10}, {text:"Go back", next:3} ],
  [ {text:"Return quietly", next:3} ],
  [ {text:"Enter code", next:"puzzleDoor"} ],
  [ {text:"Decode file", next:"puzzleFile"} ],
  [], [], [], []
];

/* --- Puzzle Handlers --- */
function showPuzzle(type) {
  const storyBox = document.getElementById('story');
  const optionsDiv = document.getElementById('options');
  optionsDiv.innerHTML = '';
  
  let puzzlePrompt = '';
  let answer = '';
  
  if(type === "door") { puzzlePrompt = "Enter the 3-digit code to unlock the door:"; answer = "427"; }
  if(type === "file") { puzzlePrompt = "Decode the file! Hint: 'LZOP' -> "; answer = "INFO"; }
  
  storyBox.innerText = puzzlePrompt;
  
  const input = document.createElement('input');
  input.className = 'puzzle-input';
  optionsDiv.appendChild(input);
  
  const submit = document.createElement('button');
  submit.className = 'puzzle-btn';
  submit.innerText = 'Submit';
  submit.onclick = () => {
    if(input.value.toUpperCase() === answer) {
      memory += 15;
      storyBox.innerText = "Correct! You advance safely.";
      optionsDiv.innerHTML = '';
      currentStep = (type==="door")?13:14;
      setTimeout(updateStory, 1000);
    } else {
      sanity -= 10;
      storyBox.innerText = "Incorrect! Sanity drops. Try again.";
      input.value = '';
    }
    updateStats();
    sanityEffect();
  };
  
  optionsDiv.appendChild(submit);
}

/* --- Restart Game --- */
function restartGame() {
  currentStep = 0; memory = 50; suspicion = 0; sanity = 100; inventory = [];
  secrets = ["Keycard", "USB Drive", "Encrypted Notes"].sort(() => Math.random() - 0.5);
  updateStory();
}

/* --- Choice Handling --- */
function chooseOption(optionIndex) {
  const currentOptions = options[currentStep];
  if (!currentOptions || currentOptions.length === 0) return;
  
  const chosen = currentOptions[optionIndex];
  
  if(chosen.next === "puzzleDoor") return showPuzzle("door");
  if(chosen.next === "puzzleFile") return showPuzzle("file");
  
  if(chosen.memory) memory += chosen.memory;
  if(chosen.suspicion) suspicion += chosen.suspicion;
  if(chosen.sanity) sanity += chosen.sanity;
  if(chosen.inventory && !inventory.includes(chosen.inventory)) inventory.push(chosen.inventory);
  
  if(Math.random() < 0.2) sanity -= 5;
  
  currentStep = chosen.next;
  updateStory();
}

/* --- Render Story & Options --- */
function updateStory() {
  const storyBox = document.getElementById('story');
  const optionContainer = document.getElementById('options');
  
  storyBox.innerText = scrambleText(storyText[currentStep]);
  optionContainer.innerHTML = '';
  updateStats();
  sanityEffect();
  
  if(options[currentStep] && options[currentStep].length > 0) {
    options[currentStep].forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.innerText = scrambleText(opt.text);
      btn.onclick = () => chooseOption(idx);
      optionContainer.appendChild(btn);
    });
  } else {
    const endingMsg = document.createElement('div');
    endingMsg.style.marginTop = '1rem';
    endingMsg.innerText = "THE END\n";
    optionContainer.appendChild(endingMsg);
    
    const restartBtn = document.createElement('button');
    restartBtn.innerText = "Restart Game";
    restartBtn.className = 'restart-btn';
    restartBtn.onclick = restartGame;
    optionContainer.appendChild(restartBtn);
  }
}

/* --- Initialize --- */
updateStory();
</script>

</body>
</html>